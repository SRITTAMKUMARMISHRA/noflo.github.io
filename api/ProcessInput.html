---
layout: default
title: "ProcessInput API"
categories:
  - api
---
  <div class="row-fluid">
    <div class="page-title documentation-page-title">
      <div class="container">
        <h1 class="page-title__title">API Documentation</h1>
        <a href="https://github.com/noflo/noflo/blob/master/src/lib/ProcessInput.coffee" class="btn btn-primary page-title__button big-button">On GitHub</a>
      </div>
    </div>
  </div>

  <div class="row-fluid">
    <div class="container documentation-main-container">
      <div class="main">
        <div class="sidebar span4">
        
          <nav>
            <ul class="sidebar__nav">
              
                
                
                <li>
                  <a {% if page.url == '/api/AsCallback/index.html' %}class="active" {% endif %}href="/api/AsCallback/">
                    AsCallback
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/AsComponent/index.html' %}class="active" {% endif %}href="/api/AsComponent/">
                    AsComponent
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/BaseNetwork/index.html' %}class="active" {% endif %}href="/api/BaseNetwork/">
                    BaseNetwork
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/BasePort/index.html' %}class="active" {% endif %}href="/api/BasePort/">
                    BasePort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Component/index.html' %}class="active" {% endif %}href="/api/Component/">
                    Component
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ComponentLoader/index.html' %}class="active" {% endif %}href="/api/ComponentLoader/">
                    ComponentLoader
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/IP/index.html' %}class="active" {% endif %}href="/api/IP/">
                    IP
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/InPort/index.html' %}class="active" {% endif %}href="/api/InPort/">
                    InPort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/InternalSocket/index.html' %}class="active" {% endif %}href="/api/InternalSocket/">
                    InternalSocket
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/LegacyNetwork/index.html' %}class="active" {% endif %}href="/api/LegacyNetwork/">
                    LegacyNetwork
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Network/index.html' %}class="active" {% endif %}href="/api/Network/">
                    Network
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/NoFlo/index.html' %}class="active" {% endif %}href="/api/NoFlo/">
                    NoFlo
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/OutPort/index.html' %}class="active" {% endif %}href="/api/OutPort/">
                    OutPort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Platform/index.html' %}class="active" {% endif %}href="/api/Platform/">
                    Platform
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Ports/index.html' %}class="active" {% endif %}href="/api/Ports/">
                    Ports
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessContext/index.html' %}class="active" {% endif %}href="/api/ProcessContext/">
                    ProcessContext
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessInput/index.html' %}class="active" {% endif %}href="/api/ProcessInput/">
                    ProcessInput
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessOutput/index.html' %}class="active" {% endif %}href="/api/ProcessOutput/">
                    ProcessOutput
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Utils/index.html' %}class="active" {% endif %}href="/api/Utils/">
                    Utils
                  </a>
                </li>
                
              
            </ul>
          </nav>
        
        </div>
        <div class="content span8">
          <h1>{{ page.title }}</h1>
          
            
            
            
              <div class='highlight'><pre><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_slicedToArray</span>(<span class="hljs-params">arr, i</span>) </span>{ <span class="hljs-keyword">return</span> _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_nonIterableRest</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&quot;Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.&quot;</span>); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_iterableToArrayLimit</span>(<span class="hljs-params">arr, i</span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&quot;undefined&quot;</span> || !(<span class="hljs-built_in">Symbol</span>.iterator <span class="hljs-keyword">in</span> <span class="hljs-built_in">Object</span>(arr))) <span class="hljs-keyword">return</span>; <span class="hljs-keyword">var</span> _arr = []; <span class="hljs-keyword">var</span> _n = <span class="hljs-literal">true</span>; <span class="hljs-keyword">var</span> _d = <span class="hljs-literal">false</span>; <span class="hljs-keyword">var</span> _e = <span class="hljs-literal">undefined</span>; <span class="hljs-keyword">try</span> { <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _i = arr[<span class="hljs-built_in">Symbol</span>.iterator](), _s; !(_n = (_s = _i.next()).done); _n = <span class="hljs-literal">true</span>) { _arr.push(_s.value); <span class="hljs-keyword">if</span> (i &amp;&amp; _arr.length === i) <span class="hljs-keyword">break</span>; } } <span class="hljs-keyword">catch</span> (err) { _d = <span class="hljs-literal">true</span>; _e = err; } <span class="hljs-keyword">finally</span> { <span class="hljs-keyword">try</span> { <span class="hljs-keyword">if</span> (!_n &amp;&amp; _i[<span class="hljs-string">&quot;return&quot;</span>] != <span class="hljs-literal">null</span>) _i[<span class="hljs-string">&quot;return&quot;</span>](); } <span class="hljs-keyword">finally</span> { <span class="hljs-keyword">if</span> (_d) <span class="hljs-keyword">throw</span> _e; } } <span class="hljs-keyword">return</span> _arr; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_arrayWithHoles</span>(<span class="hljs-params">arr</span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arr)) <span class="hljs-keyword">return</span> arr; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-string">&quot;@babel/helpers - typeof&quot;</span>; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&quot;function&quot;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span>.iterator === <span class="hljs-string">&quot;symbol&quot;</span>) { _typeof = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj; }; } <span class="hljs-keyword">else</span> { _typeof = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> obj &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&quot;function&quot;</span> &amp;&amp; obj.constructor === <span class="hljs-built_in">Symbol</span> &amp;&amp; obj !== <span class="hljs-built_in">Symbol</span>.prototype ? <span class="hljs-string">&quot;symbol&quot;</span> : <span class="hljs-keyword">typeof</span> obj; }; } <span class="hljs-keyword">return</span> _typeof(obj); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_toConsumableArray</span>(<span class="hljs-params">arr</span>) </span>{ <span class="hljs-keyword">return</span> _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_nonIterableSpread</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&quot;Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.&quot;</span>); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_unsupportedIterableToArray</span>(<span class="hljs-params">o, minLen</span>) </span>{ <span class="hljs-keyword">if</span> (!o) <span class="hljs-keyword">return</span>; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> o === <span class="hljs-string">&quot;string&quot;</span>) <span class="hljs-keyword">return</span> _arrayLikeToArray(o, minLen); <span class="hljs-keyword">var</span> n = <span class="hljs-built_in">Object</span>.prototype.toString.call(o).slice(<span class="hljs-number">8</span>, <span class="hljs-number">-1</span>); <span class="hljs-keyword">if</span> (n === <span class="hljs-string">&quot;Object&quot;</span> &amp;&amp; o.constructor) n = o.constructor.name; <span class="hljs-keyword">if</span> (n === <span class="hljs-string">&quot;Map&quot;</span> || n === <span class="hljs-string">&quot;Set&quot;</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.from(o); <span class="hljs-keyword">if</span> (n === <span class="hljs-string">&quot;Arguments&quot;</span> || <span class="hljs-regexp">/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/</span>.test(n)) <span class="hljs-keyword">return</span> _arrayLikeToArray(o, minLen); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_iterableToArray</span>(<span class="hljs-params">iter</span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> !== <span class="hljs-string">&quot;undefined&quot;</span> &amp;&amp; <span class="hljs-built_in">Symbol</span>.iterator <span class="hljs-keyword">in</span> <span class="hljs-built_in">Object</span>(iter)) <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.from(iter); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_arrayWithoutHoles</span>(<span class="hljs-params">arr</span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(arr)) <span class="hljs-keyword">return</span> _arrayLikeToArray(arr); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_arrayLikeToArray</span>(<span class="hljs-params">arr, len</span>) </span>{ <span class="hljs-keyword">if</span> (len == <span class="hljs-literal">null</span> || len &gt; arr.length) len = arr.length; <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, arr2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(len); i &lt; len; i++) { arr2[i] = arr[i]; } <span class="hljs-keyword">return</span> arr2; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_classCallCheck</span>(<span class="hljs-params">instance, Constructor</span>) </span>{ <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> Constructor)) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&quot;Cannot call a class as a function&quot;</span>); } }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_defineProperties</span>(<span class="hljs-params">target, props</span>) </span>{ <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; props.length; i++) { <span class="hljs-keyword">var</span> descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || <span class="hljs-literal">false</span>; descriptor.configurable = <span class="hljs-literal">true</span>; <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;value&quot;</span> <span class="hljs-keyword">in</span> descriptor) descriptor.writable = <span class="hljs-literal">true</span>; <span class="hljs-built_in">Object</span>.defineProperty(target, descriptor.key, descriptor); } }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createClass</span>(<span class="hljs-params">Constructor, protoProps, staticProps</span>) </span>{ <span class="hljs-keyword">if</span> (protoProps) _defineProperties(Constructor.prototype, protoProps); <span class="hljs-keyword">if</span> (staticProps) _defineProperties(Constructor, staticProps); <span class="hljs-keyword">return</span> Constructor; }</pre></div>
            
          
            
            <pre><code>NoFlo - Flow-Based Programming <span class="hljs-keyword">for</span> JavaScript
(c) <span class="hljs-number">2013</span><span class="hljs-number">-2020</span> Flowhub UG
(c) <span class="hljs-number">2011</span><span class="hljs-number">-2012</span> Henri Bergius, Nemein
NoFlo may be freely distributed under the MIT license</code></pre>

            
              <div class='highlight'><pre>
<span class="hljs-comment">/* eslint-disable no-underscore-dangle */</span>
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;noflo:component&#x27;</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ProcessInput</span>(<span class="hljs-params">ports, context</span>) </span>{
    _classCallCheck(<span class="hljs-built_in">this</span>, ProcessInput);

    <span class="hljs-built_in">this</span>.ports = ports;
    <span class="hljs-built_in">this</span>.context = context;
    <span class="hljs-built_in">this</span>.nodeInstance = <span class="hljs-built_in">this</span>.context.nodeInstance;
    <span class="hljs-built_in">this</span>.ip = <span class="hljs-built_in">this</span>.context.ip;
    <span class="hljs-built_in">this</span>.port = <span class="hljs-built_in">this</span>.context.port;
    <span class="hljs-built_in">this</span>.result = <span class="hljs-built_in">this</span>.context.result;
    <span class="hljs-built_in">this</span>.scope = <span class="hljs-built_in">this</span>.context.scope;
  } <span class="hljs-comment">// When preconditions are met, set component state to `activated`</span>


  _createClass(ProcessInput, [{
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;activate&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">activate</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.context.activated) {
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.nodeInstance.isOrdered()) {</pre></div>
            
          
            
            <p>We’re handling packets in order. Set the result as non-resolved
so that it can be send when the order comes up</p>

            
              <div class='highlight'><pre>        <span class="hljs-built_in">this</span>.result.__resolved = <span class="hljs-literal">false</span>;
      }

      <span class="hljs-built_in">this</span>.nodeInstance.activate(<span class="hljs-built_in">this</span>.context);

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.port.isAddressable()) {
        debug(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeInstance.nodeId, <span class="hljs-string">&quot; packet on &#x27;&quot;</span>).concat(<span class="hljs-built_in">this</span>.port.name, <span class="hljs-string">&quot;[&quot;</span>).concat(<span class="hljs-built_in">this</span>.ip.index, <span class="hljs-string">&quot;]&#x27; caused activation &quot;</span>).concat(<span class="hljs-built_in">this</span>.nodeInstance.load, <span class="hljs-string">&quot;: &quot;</span>).concat(<span class="hljs-built_in">this</span>.ip.type));
      } <span class="hljs-keyword">else</span> {
        debug(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeInstance.nodeId, <span class="hljs-string">&quot; packet on &#x27;&quot;</span>).concat(<span class="hljs-built_in">this</span>.port.name, <span class="hljs-string">&quot;&#x27; caused activation &quot;</span>).concat(<span class="hljs-built_in">this</span>.nodeInstance.load, <span class="hljs-string">&quot;: &quot;</span>).concat(<span class="hljs-built_in">this</span>.ip.type));
      }
    } <span class="hljs-comment">// ## Connection listing</span></pre></div>
            
          
            
            <p>This allows components to check which input ports are attached. This is
useful mainly for addressable ports</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;attached&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attached</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _this = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len), _key = <span class="hljs-number">0</span>; _key &lt; _len; _key++) {
        params[_key] = <span class="hljs-built_in">arguments</span>[_key];
      }

      <span class="hljs-keyword">var</span> args = params;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">var</span> res = [];
      args.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">port</span>) </span>{
        <span class="hljs-keyword">if</span> (!_this.ports[port]) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Node &quot;</span>.concat(_this.nodeInstance.nodeId, <span class="hljs-string">&quot; has no port &#x27;&quot;</span>).concat(port, <span class="hljs-string">&quot;&#x27;&quot;</span>));
        }

        res.push(_this.ports[port].listAttached());
      });

      <span class="hljs-keyword">if</span> (args.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> res.pop();
      }

      <span class="hljs-keyword">return</span> res;
    } <span class="hljs-comment">// ## Input preconditions</span></pre></div>
            
          
            
            <p>When the processing function is called, it can check if input buffers
contain the packets needed for the process to fire.
This precondition handling is done via the <code>has</code> and <code>hasStream</code> methods.
Returns true if a port (or ports joined by logical AND) has a new IP
Passing a validation callback as a last argument allows more selective
checking of packets.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;has&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">has</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len2 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len2), _key2 = <span class="hljs-number">0</span>; _key2 &lt; _len2; _key2++) {
        params[_key2] = <span class="hljs-built_in">arguments</span>[_key2];
      }

      <span class="hljs-keyword">var</span> args = params;
      <span class="hljs-keyword">var</span> validate;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[args.length - <span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;function&#x27;</span>) {
        validate = args.pop();
      } <span class="hljs-keyword">else</span> {
        validate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        };
      }

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i += <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> port = args[i];

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(port)) {
          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[port[<span class="hljs-number">0</span>]]) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Node &quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeInstance.nodeId, <span class="hljs-string">&quot; has no port &#x27;&quot;</span>).concat(port[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;&#x27;&quot;</span>));
          }

          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[port[<span class="hljs-number">0</span>]].isAddressable()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Non-addressable ports, access must be with string &quot;</span>.concat(port[<span class="hljs-number">0</span>]));
          }

          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[port[<span class="hljs-number">0</span>]].has(<span class="hljs-built_in">this</span>.scope, port[<span class="hljs-number">1</span>], validate)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[port]) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;Node &quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeInstance.nodeId, <span class="hljs-string">&quot; has no port &#x27;&quot;</span>).concat(port, <span class="hljs-string">&quot;&#x27;&quot;</span>));
          }

          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.ports[port].isAddressable()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&quot;For addressable ports, access must be with array [&quot;</span>.concat(port, <span class="hljs-string">&quot;, idx]&quot;</span>));
          }

          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[port].has(<span class="hljs-built_in">this</span>.scope, validate)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }
        }
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-comment">// Returns true if the ports contain data packets</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;hasData&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasData</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len3 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len3), _key3 = <span class="hljs-number">0</span>; _key3 &lt; _len3; _key3++) {
        params[_key3] = <span class="hljs-built_in">arguments</span>[_key3];
      }

      <span class="hljs-keyword">var</span> args = params;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      args.push(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
        <span class="hljs-keyword">return</span> ip.type === <span class="hljs-string">&#x27;data&#x27;</span>;
      });
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.has.apply(<span class="hljs-built_in">this</span>, _toConsumableArray(args));
    } <span class="hljs-comment">// Returns true if a port has a complete stream in its input buffer.</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;hasStream&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasStream</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _this2 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len4 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len4), _key4 = <span class="hljs-number">0</span>; _key4 &lt; _len4; _key4++) {
        params[_key4] = <span class="hljs-built_in">arguments</span>[_key4];
      }

      <span class="hljs-keyword">var</span> args = params;
      <span class="hljs-keyword">var</span> validateStream;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> args[args.length - <span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;function&#x27;</span>) {
        validateStream = args.pop();
      } <span class="hljs-keyword">else</span> {
        validateStream = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateStream</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        };
      }

      <span class="hljs-keyword">var</span> _loop = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_loop</span>(<span class="hljs-params">i</span>) </span>{
        <span class="hljs-keyword">var</span> port = args[i];
        <span class="hljs-keyword">var</span> portBrackets = [];
        <span class="hljs-keyword">var</span> hasData = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">var</span> validate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params">ip</span>) </span>{
          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {
            portBrackets.push(ip.data);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }

          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;data&#x27;</span>) {</pre></div>
            
          
            
            <p>Run the stream validation callback</p>

            
              <div class='highlight'><pre>            hasData = validateStream(ip, portBrackets); <span class="hljs-comment">// Data IP on its own is a valid stream</span>

            <span class="hljs-keyword">if</span> (!portBrackets.length) {
              <span class="hljs-keyword">return</span> hasData;
            } <span class="hljs-comment">// Otherwise we need to check for complete stream</span>


            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
          }

          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {
            portBrackets.pop();

            <span class="hljs-keyword">if</span> (portBrackets.length) {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">if</span> (!hasData) {
              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
          }

          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        };

        <span class="hljs-keyword">if</span> (!_this2.has(port, validate)) {
          <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">v</span>: <span class="hljs-literal">false</span>
          };
        }
      };

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i += <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> _ret = _loop(i);

        <span class="hljs-keyword">if</span> (_typeof(_ret) === <span class="hljs-string">&quot;object&quot;</span>) <span class="hljs-keyword">return</span> _ret.v;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-comment">// ## Input processing</span></pre></div>
            
          
            
            <p>Once preconditions have been met, the processing function can read from
the input buffers. Reading packets sets the component as “activated”.</p>
<p>Fetches IP object(s) for port(s)</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;get&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-built_in">this</span>.activate();

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len5 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len5), _key5 = <span class="hljs-number">0</span>; _key5 &lt; _len5; _key5++) {
        params[_key5] = <span class="hljs-built_in">arguments</span>[_key5];
      }

      <span class="hljs-keyword">var</span> args = params;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">var</span> res = [];

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i += <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> port = args[i];
        <span class="hljs-keyword">var</span> idx = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> ip = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> portname = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(port)) {
          <span class="hljs-keyword">var</span> _Array$from = <span class="hljs-built_in">Array</span>.from(port);

          <span class="hljs-keyword">var</span> _Array$from2 = _slicedToArray(_Array$from, <span class="hljs-number">2</span>);

          portname = _Array$from2[<span class="hljs-number">0</span>];
          idx = _Array$from2[<span class="hljs-number">1</span>];

          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.ports[portname].isAddressable()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Non-addressable ports, access must be with string portname&#x27;</span>);
          }
        } <span class="hljs-keyword">else</span> {
          portname = port;

          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.ports[portname].isAddressable()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;For addressable ports, access must be with array [portname, idx]&#x27;</span>);
          }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.nodeInstance.isForwardingInport(portname)) {
          ip = <span class="hljs-built_in">this</span>.__getForForwarding(portname, idx);
          res.push(ip);
        } <span class="hljs-keyword">else</span> {
          ip = <span class="hljs-built_in">this</span>.ports[portname].get(<span class="hljs-built_in">this</span>.scope, idx);
          res.push(ip);
        }
      }

      <span class="hljs-keyword">if</span> (args.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> res[<span class="hljs-number">0</span>];
      }

      <span class="hljs-keyword">return</span> res;
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;__getForForwarding&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__getForForwarding</span>(<span class="hljs-params">port, idx</span>) </span>{
      <span class="hljs-keyword">var</span> prefix = [];
      <span class="hljs-keyword">var</span> dataIp = <span class="hljs-literal">null</span>; <span class="hljs-comment">// Read IPs until we hit data</span>

      <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">true</span>;

      <span class="hljs-keyword">while</span> (ok) {</pre></div>
            
          
            
            <p>Read next packet</p>

            
              <div class='highlight'><pre>        <span class="hljs-keyword">var</span> ip = <span class="hljs-built_in">this</span>.ports[port].get(<span class="hljs-built_in">this</span>.scope, idx); <span class="hljs-comment">// Stop at the end of the buffer</span>

        <span class="hljs-keyword">if</span> (!ip) {
          <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;data&#x27;</span>) {</pre></div>
            
          
            
            <p>Hit the data IP, stop here</p>

            
              <div class='highlight'><pre>          dataIp = ip;
          ok = <span class="hljs-literal">false</span>;
          <span class="hljs-keyword">break</span>;
        } <span class="hljs-comment">// Keep track of bracket closings and openings before</span>


        prefix.push(ip);
      } <span class="hljs-comment">// Forwarding brackets that came before data packet need to manipulate context</span></pre></div>
            
          
            
            <p>and be added to result so they can be forwarded correctly to ports that
need them</p>

            
              <div class='highlight'><pre>

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; prefix.length; i += <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> _ip = prefix[i];

        <span class="hljs-keyword">if</span> (_ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {</pre></div>
            
          
            
            <p>Bracket closings before data should remove bracket context</p>

            
              <div class='highlight'><pre>          <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.result.__bracketClosingBefore) {
            <span class="hljs-built_in">this</span>.result.__bracketClosingBefore = [];
          }

          <span class="hljs-keyword">var</span> context = <span class="hljs-built_in">this</span>.nodeInstance.getBracketContext(<span class="hljs-string">&#x27;in&#x27;</span>, port, <span class="hljs-built_in">this</span>.scope, idx).pop();
          context.closeIp = _ip;

          <span class="hljs-built_in">this</span>.result.__bracketClosingBefore.push(context);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {</pre></div>
            
          
            
            <p>Bracket openings need to go to bracket context</p>

            
              <div class='highlight'><pre>          <span class="hljs-built_in">this</span>.nodeInstance.getBracketContext(<span class="hljs-string">&#x27;in&#x27;</span>, port, <span class="hljs-built_in">this</span>.scope, idx).push({
            <span class="hljs-attr">ip</span>: _ip,
            <span class="hljs-attr">ports</span>: [],
            <span class="hljs-attr">source</span>: port
          });
        }
      } <span class="hljs-comment">// Add current bracket context to the result so that when we send</span></pre></div>
            
          
            
            <p>to ports we can also add the surrounding brackets</p>

            
              <div class='highlight'><pre>

      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.result.__bracketContext) {
        <span class="hljs-built_in">this</span>.result.__bracketContext = {};
      }

      <span class="hljs-built_in">this</span>.result.__bracketContext[port] = <span class="hljs-built_in">this</span>.nodeInstance.getBracketContext(<span class="hljs-string">&#x27;in&#x27;</span>, port, <span class="hljs-built_in">this</span>.scope, idx).slice(<span class="hljs-number">0</span>); <span class="hljs-comment">// Bracket closings that were in buffer after the data packet need to</span></pre></div>
            
          
            
            <p>be added to result for done() to read them from</p>

            
              <div class='highlight'><pre>
      <span class="hljs-keyword">return</span> dataIp;
    } <span class="hljs-comment">// Fetches `data` property of IP object(s) for given port(s)</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getData&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _this3 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len6 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len6), _key6 = <span class="hljs-number">0</span>; _key6 &lt; _len6; _key6++) {
        params[_key6] = <span class="hljs-built_in">arguments</span>[_key6];
      }

      <span class="hljs-keyword">var</span> args = params;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">var</span> datas = [];
      args.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">port</span>) </span>{
        <span class="hljs-keyword">var</span> packet = _this3.get(port);

        <span class="hljs-keyword">if</span> (packet == <span class="hljs-literal">null</span>) {</pre></div>
            
          
            
            <p>we add the null packet to the array so when getting
multiple ports, if one is null we still return it
so the indexes are correct.</p>

            
              <div class='highlight'><pre>          datas.push(packet);
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">while</span> (packet.type !== <span class="hljs-string">&#x27;data&#x27;</span>) {
          packet = _this3.get(port);

          <span class="hljs-keyword">if</span> (!packet) {
            <span class="hljs-keyword">break</span>;
          }
        }

        datas.push(packet.data);
      });

      <span class="hljs-keyword">if</span> (args.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> datas.pop();
      }

      <span class="hljs-keyword">return</span> datas;
    } <span class="hljs-comment">// Fetches a complete data stream from the buffer.</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getStream&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStream</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> _len7 = <span class="hljs-built_in">arguments</span>.length, params = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(_len7), _key7 = <span class="hljs-number">0</span>; _key7 &lt; _len7; _key7++) {
        params[_key7] = <span class="hljs-built_in">arguments</span>[_key7];
      }

      <span class="hljs-keyword">var</span> args = params;

      <span class="hljs-keyword">if</span> (!args.length) {
        args = [<span class="hljs-string">&#x27;in&#x27;</span>];
      }

      <span class="hljs-keyword">var</span> datas = [];

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i += <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> port = args[i];
        <span class="hljs-keyword">var</span> portBrackets = [];
        <span class="hljs-keyword">var</span> portPackets = [];
        <span class="hljs-keyword">var</span> hasData = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> ip = <span class="hljs-built_in">this</span>.get(port);

        <span class="hljs-keyword">if</span> (!ip) {
          datas.push(<span class="hljs-literal">undefined</span>);
        }

        <span class="hljs-keyword">while</span> (ip) {
          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {
            <span class="hljs-keyword">if</span> (!portBrackets.length) {</pre></div>
            
          
            
            <p>First openBracket in stream, drop previous</p>

            
              <div class='highlight'><pre>              portPackets = [];
              hasData = <span class="hljs-literal">false</span>;
            }

            portBrackets.push(ip.data);
            portPackets.push(ip);
          }

          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;data&#x27;</span>) {
            portPackets.push(ip);
            hasData = <span class="hljs-literal">true</span>; <span class="hljs-comment">// Unbracketed data packet is a valid stream</span>

            <span class="hljs-keyword">if</span> (!portBrackets.length) {
              <span class="hljs-keyword">break</span>;
            }
          }

          <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {
            portPackets.push(ip);
            portBrackets.pop();

            <span class="hljs-keyword">if</span> (hasData &amp;&amp; !portBrackets.length) {</pre></div>
            
          
            
            <p>Last close bracket finishes stream if there was data inside</p>

            
              <div class='highlight'><pre>              <span class="hljs-keyword">break</span>;
            }
          }

          ip = <span class="hljs-built_in">this</span>.get(port);
        }

        datas.push(portPackets);
      }

      <span class="hljs-keyword">if</span> (args.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> datas.pop();
      }

      <span class="hljs-keyword">return</span> datas;
    }
  }]);

  <span class="hljs-keyword">return</span> ProcessInput;
}();</pre></div>
            
          
          <p><small>This page contains documentation generated automatically from NoFlo's <a href="https://github.com/noflo/noflo/blob/master/src/lib/ProcessInput.coffee">ProcessInput.coffee</a> file.</small></p>
        </div>
      </div>
    </div>
  </div>
