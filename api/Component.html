---
layout: default
title: "Component API"
categories:
  - api
---
  <div class="row-fluid">
    <div class="page-title documentation-page-title">
      <div class="container">
        <h1 class="page-title__title">API Documentation</h1>
        <a href="https://github.com/noflo/noflo/blob/master/src/lib/Component.coffee" class="btn btn-primary page-title__button big-button">On GitHub</a>
      </div>
    </div>
  </div>

  <div class="row-fluid">
    <div class="container documentation-main-container">
      <div class="main">
        <div class="sidebar span4">
        
          <nav>
            <ul class="sidebar__nav">
              
                
                
                <li>
                  <a {% if page.url == '/api/AsCallback/index.html' %}class="active" {% endif %}href="/api/AsCallback/">
                    AsCallback
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/AsComponent/index.html' %}class="active" {% endif %}href="/api/AsComponent/">
                    AsComponent
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/BaseNetwork/index.html' %}class="active" {% endif %}href="/api/BaseNetwork/">
                    BaseNetwork
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/BasePort/index.html' %}class="active" {% endif %}href="/api/BasePort/">
                    BasePort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Component/index.html' %}class="active" {% endif %}href="/api/Component/">
                    Component
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ComponentLoader/index.html' %}class="active" {% endif %}href="/api/ComponentLoader/">
                    ComponentLoader
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/IP/index.html' %}class="active" {% endif %}href="/api/IP/">
                    IP
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/InPort/index.html' %}class="active" {% endif %}href="/api/InPort/">
                    InPort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/InternalSocket/index.html' %}class="active" {% endif %}href="/api/InternalSocket/">
                    InternalSocket
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/LegacyNetwork/index.html' %}class="active" {% endif %}href="/api/LegacyNetwork/">
                    LegacyNetwork
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Network/index.html' %}class="active" {% endif %}href="/api/Network/">
                    Network
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/NoFlo/index.html' %}class="active" {% endif %}href="/api/NoFlo/">
                    NoFlo
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/OutPort/index.html' %}class="active" {% endif %}href="/api/OutPort/">
                    OutPort
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Platform/index.html' %}class="active" {% endif %}href="/api/Platform/">
                    Platform
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Ports/index.html' %}class="active" {% endif %}href="/api/Ports/">
                    Ports
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessContext/index.html' %}class="active" {% endif %}href="/api/ProcessContext/">
                    ProcessContext
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessInput/index.html' %}class="active" {% endif %}href="/api/ProcessInput/">
                    ProcessInput
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/ProcessOutput/index.html' %}class="active" {% endif %}href="/api/ProcessOutput/">
                    ProcessOutput
                  </a>
                </li>
                
              
                
                
                <li>
                  <a {% if page.url == '/api/Utils/index.html' %}class="active" {% endif %}href="/api/Utils/">
                    Utils
                  </a>
                </li>
                
              
            </ul>
          </nav>
        
        </div>
        <div class="content span8">
          <h1>{{ page.title }}</h1>
          
            
            
            
              <div class='highlight'><pre><span class="hljs-meta">&quot;use strict&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-string">&quot;@babel/helpers - typeof&quot;</span>; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&quot;function&quot;</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span>.iterator === <span class="hljs-string">&quot;symbol&quot;</span>) { _typeof = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj; }; } <span class="hljs-keyword">else</span> { _typeof = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_typeof</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-keyword">return</span> obj &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> === <span class="hljs-string">&quot;function&quot;</span> &amp;&amp; obj.constructor === <span class="hljs-built_in">Symbol</span> &amp;&amp; obj !== <span class="hljs-built_in">Symbol</span>.prototype ? <span class="hljs-string">&quot;symbol&quot;</span> : <span class="hljs-keyword">typeof</span> obj; }; } <span class="hljs-keyword">return</span> _typeof(obj); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_classCallCheck</span>(<span class="hljs-params">instance, Constructor</span>) </span>{ <span class="hljs-keyword">if</span> (!(instance <span class="hljs-keyword">instanceof</span> Constructor)) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&quot;Cannot call a class as a function&quot;</span>); } }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_defineProperties</span>(<span class="hljs-params">target, props</span>) </span>{ <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; props.length; i++) { <span class="hljs-keyword">var</span> descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || <span class="hljs-literal">false</span>; descriptor.configurable = <span class="hljs-literal">true</span>; <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;value&quot;</span> <span class="hljs-keyword">in</span> descriptor) descriptor.writable = <span class="hljs-literal">true</span>; <span class="hljs-built_in">Object</span>.defineProperty(target, descriptor.key, descriptor); } }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createClass</span>(<span class="hljs-params">Constructor, protoProps, staticProps</span>) </span>{ <span class="hljs-keyword">if</span> (protoProps) _defineProperties(Constructor.prototype, protoProps); <span class="hljs-keyword">if</span> (staticProps) _defineProperties(Constructor, staticProps); <span class="hljs-keyword">return</span> Constructor; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_inherits</span>(<span class="hljs-params">subClass, superClass</span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> superClass !== <span class="hljs-string">&quot;function&quot;</span> &amp;&amp; superClass !== <span class="hljs-literal">null</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">&quot;Super expression must either be null or a function&quot;</span>); } subClass.prototype = <span class="hljs-built_in">Object</span>.create(superClass &amp;&amp; superClass.prototype, { <span class="hljs-attr">constructor</span>: { <span class="hljs-attr">value</span>: subClass, <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span> } }); <span class="hljs-keyword">if</span> (superClass) _setPrototypeOf(subClass, superClass); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_setPrototypeOf</span>(<span class="hljs-params">o, p</span>) </span>{ _setPrototypeOf = <span class="hljs-built_in">Object</span>.setPrototypeOf || <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_setPrototypeOf</span>(<span class="hljs-params">o, p</span>) </span>{ o.__proto__ = p; <span class="hljs-keyword">return</span> o; }; <span class="hljs-keyword">return</span> _setPrototypeOf(o, p); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createSuper</span>(<span class="hljs-params">Derived</span>) </span>{ <span class="hljs-keyword">var</span> hasNativeReflectConstruct = _isNativeReflectConstruct(); <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_createSuperInternal</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">var</span> Super = _getPrototypeOf(Derived), result; <span class="hljs-keyword">if</span> (hasNativeReflectConstruct) { <span class="hljs-keyword">var</span> NewTarget = _getPrototypeOf(<span class="hljs-built_in">this</span>).constructor; result = <span class="hljs-built_in">Reflect</span>.construct(Super, <span class="hljs-built_in">arguments</span>, NewTarget); } <span class="hljs-keyword">else</span> { result = Super.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>); } <span class="hljs-keyword">return</span> _possibleConstructorReturn(<span class="hljs-built_in">this</span>, result); }; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_possibleConstructorReturn</span>(<span class="hljs-params">self, call</span>) </span>{ <span class="hljs-keyword">if</span> (call &amp;&amp; (_typeof(call) === <span class="hljs-string">&quot;object&quot;</span> || <span class="hljs-keyword">typeof</span> call === <span class="hljs-string">&quot;function&quot;</span>)) { <span class="hljs-keyword">return</span> call; } <span class="hljs-keyword">return</span> _assertThisInitialized(self); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_assertThisInitialized</span>(<span class="hljs-params">self</span>) </span>{ <span class="hljs-keyword">if</span> (self === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">ReferenceError</span>(<span class="hljs-string">&quot;this hasn&#x27;t been initialised - super() hasn&#x27;t been called&quot;</span>); } <span class="hljs-keyword">return</span> self; }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_isNativeReflectConstruct</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Reflect</span> === <span class="hljs-string">&quot;undefined&quot;</span> || !<span class="hljs-built_in">Reflect</span>.construct) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Reflect</span>.construct.sham) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Proxy</span> === <span class="hljs-string">&quot;function&quot;</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">try</span> { <span class="hljs-built_in">Date</span>.prototype.toString.call(<span class="hljs-built_in">Reflect</span>.construct(<span class="hljs-built_in">Date</span>, [], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{})); <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; } <span class="hljs-keyword">catch</span> (e) { <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; } }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getPrototypeOf</span>(<span class="hljs-params">o</span>) </span>{ _getPrototypeOf = <span class="hljs-built_in">Object</span>.setPrototypeOf ? <span class="hljs-built_in">Object</span>.getPrototypeOf : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getPrototypeOf</span>(<span class="hljs-params">o</span>) </span>{ <span class="hljs-keyword">return</span> o.__proto__ || <span class="hljs-built_in">Object</span>.getPrototypeOf(o); }; <span class="hljs-keyword">return</span> _getPrototypeOf(o); }</pre></div>
            
          
            
            <pre><code>NoFlo - Flow-Based Programming <span class="hljs-keyword">for</span> JavaScript
(c) <span class="hljs-number">2013</span><span class="hljs-number">-2017</span> Flowhub UG
(c) <span class="hljs-number">2011</span><span class="hljs-number">-2012</span> Henri Bergius, Nemein
NoFlo may be freely distributed under the MIT license</code></pre>

            
              <div class='highlight'><pre>
<span class="hljs-comment">/* eslint-disable
    class-methods-use-this,
    no-underscore-dangle,
*/</span>
<span class="hljs-keyword">var</span> _require = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;events&#x27;</span>),
    EventEmitter = _require.EventEmitter;

<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;noflo:component&#x27;</span>);

<span class="hljs-keyword">var</span> debugBrackets = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;noflo:component:brackets&#x27;</span>);

<span class="hljs-keyword">var</span> debugSend = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;debug&#x27;</span>)(<span class="hljs-string">&#x27;noflo:component:send&#x27;</span>);

<span class="hljs-keyword">var</span> ports = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./Ports&#x27;</span>);

<span class="hljs-keyword">var</span> ProcessContext = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./ProcessContext&#x27;</span>);

<span class="hljs-keyword">var</span> ProcessInput = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./ProcessInput&#x27;</span>);

<span class="hljs-keyword">var</span> ProcessOutput = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./ProcessOutput&#x27;</span>); <span class="hljs-comment">// ## NoFlo Component Base class</span></pre></div>
            
          
            
            <p>The <code>noflo.Component</code> interface provides a way to instantiate
and extend NoFlo components.</p>

            
              <div class='highlight'><pre>

<span class="hljs-keyword">var</span> Component = <span class="hljs-comment">/*#__PURE__*/</span><span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">_EventEmitter</span>) </span>{
  _inherits(Component, _EventEmitter);

  <span class="hljs-keyword">var</span> _super = _createSuper(Component);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Component</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> _this;

    <span class="hljs-keyword">var</span> options = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] : {};

    _classCallCheck(<span class="hljs-built_in">this</span>, Component);

    _this = _super.call(<span class="hljs-built_in">this</span>);
    <span class="hljs-keyword">var</span> opts = options; <span class="hljs-comment">// Prepare inports, if any were given in options.</span></pre></div>
            
          
            
            <p>They can also be set up imperatively after component
instantiation by using the <code>component.inPorts.add</code>
method.</p>

            
              <div class='highlight'><pre>
    <span class="hljs-keyword">if</span> (!opts.inPorts) {
      opts.inPorts = {};
    }

    <span class="hljs-keyword">if</span> (opts.inPorts <span class="hljs-keyword">instanceof</span> ports.InPorts) {
      _this.inPorts = opts.inPorts;
    } <span class="hljs-keyword">else</span> {
      _this.inPorts = <span class="hljs-keyword">new</span> ports.InPorts(opts.inPorts);
    } <span class="hljs-comment">// Prepare outports, if any were given in opts.</span></pre></div>
            
          
            
            <p>They can also be set up imperatively after component
instantiation by using the <code>component.outPorts.add</code>
method.</p>

            
              <div class='highlight'><pre>

    <span class="hljs-keyword">if</span> (!opts.outPorts) {
      opts.outPorts = {};
    }

    <span class="hljs-keyword">if</span> (opts.outPorts <span class="hljs-keyword">instanceof</span> ports.OutPorts) {
      _this.outPorts = opts.outPorts;
    } <span class="hljs-keyword">else</span> {
      _this.outPorts = <span class="hljs-keyword">new</span> ports.OutPorts(opts.outPorts);
    } <span class="hljs-comment">// Set the default component icon and description</span>


    _this.icon = opts.icon ? opts.icon : _this.constructor.icon;
    _this.description = opts.description ? opts.description : _this.constructor.description; <span class="hljs-comment">// Initially the component is not started</span>

    _this.started = <span class="hljs-literal">false</span>;
    _this.load = <span class="hljs-number">0</span>; <span class="hljs-comment">// Whether the component should keep send packets</span></pre></div>
            
          
            
            <p>out in the order they were received</p>

            
              <div class='highlight'><pre>
    _this.ordered = opts.ordered != <span class="hljs-literal">null</span> ? opts.ordered : <span class="hljs-literal">false</span>;
    _this.autoOrdering = opts.autoOrdering != <span class="hljs-literal">null</span> ? opts.autoOrdering : <span class="hljs-literal">null</span>; <span class="hljs-comment">// Queue for handling ordered output packets</span>

    _this.outputQ = []; <span class="hljs-comment">// Context used for bracket forwarding</span>

    _this.bracketContext = {
      <span class="hljs-string">&quot;in&quot;</span>: {},
      <span class="hljs-attr">out</span>: {}
    }; <span class="hljs-comment">// Whether the component should activate when it</span></pre></div>
            
          
            
            <p>receives packets</p>

            
              <div class='highlight'><pre>
    _this.activateOnInput = opts.activateOnInput != <span class="hljs-literal">null</span> ? opts.activateOnInput : <span class="hljs-literal">true</span>; <span class="hljs-comment">// Bracket forwarding rules. By default we forward</span></pre></div>
            
          
            
            <p>brackets from <code>in</code> port to <code>out</code> and <code>error</code> ports.</p>

            
              <div class='highlight'><pre>
    _this.forwardBrackets = {
      <span class="hljs-string">&quot;in&quot;</span>: [<span class="hljs-string">&#x27;out&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>]
    };

    <span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;forwardBrackets&#x27;</span> <span class="hljs-keyword">in</span> opts) {
      _this.forwardBrackets = opts.forwardBrackets;
    } <span class="hljs-comment">// The component&#x27;s process function can either be</span></pre></div>
            
          
            
            <p>passed in opts, or given imperatively after
instantation using the <code>component.process</code> method.</p>

            
              <div class='highlight'><pre>

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.process === <span class="hljs-string">&#x27;function&#x27;</span>) {
      _this.process(opts.process);
    }

    <span class="hljs-keyword">return</span> _this;
  }

  _createClass(Component, [{
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getDescription&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDescription</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.description;
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isReady&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isReady</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isSubgraph&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSubgraph</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;setIcon&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setIcon</span>(<span class="hljs-params">icon</span>) </span>{
      <span class="hljs-built_in">this</span>.icon = icon;
      <span class="hljs-built_in">this</span>.emit(<span class="hljs-string">&#x27;icon&#x27;</span>, <span class="hljs-built_in">this</span>.icon);
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getIcon&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getIcon</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.icon;
    } <span class="hljs-comment">// ### Error emitting helper</span></pre></div>
            
          
            
            <p>If component has an <code>error</code> outport that is connected, errors
are sent as IP objects there. If the port is not connected,
errors are thrown.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;error&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span>(<span class="hljs-params">e</span>) </span>{
      <span class="hljs-keyword">var</span> _this2 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">var</span> groups = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] : [];
      <span class="hljs-keyword">var</span> errorPort = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">2</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>] !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>] : <span class="hljs-string">&#x27;error&#x27;</span>;
      <span class="hljs-keyword">var</span> scope = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>] !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>] : <span class="hljs-literal">null</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.outPorts[errorPort] &amp;&amp; (<span class="hljs-built_in">this</span>.outPorts[errorPort].isAttached() || !<span class="hljs-built_in">this</span>.outPorts[errorPort].isRequired())) {
        groups.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">group</span>) </span>{
          _this2.outPorts[errorPort].openBracket(group, {
            <span class="hljs-attr">scope</span>: scope
          });
        });
        <span class="hljs-built_in">this</span>.outPorts[errorPort].data(e, {
          <span class="hljs-attr">scope</span>: scope
        });
        groups.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">group</span>) </span>{
          _this2.outPorts[errorPort].closeBracket(group, {
            <span class="hljs-attr">scope</span>: scope
          });
        });
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">throw</span> e;
    } <span class="hljs-comment">// ### Setup</span></pre></div>
            
          
            
            <p>The setUp method is for component-specific initialization.
Called at network start-up.</p>
<p>Override in component implementation to do component-specific
setup work.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;setUp&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setUp</span>(<span class="hljs-params">callback</span>) </span>{
      callback();
    } <span class="hljs-comment">// ### Setup</span></pre></div>
            
          
            
            <p>The tearDown method is for component-specific cleanup. Called
at network shutdown</p>
<p>Override in component implementation to do component-specific
cleanup work, like clearing any accumulated state.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;tearDown&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tearDown</span>(<span class="hljs-params">callback</span>) </span>{
      callback();
    } <span class="hljs-comment">// ### Start</span></pre></div>
            
          
            
            <p>Called when network starts. This sets calls the setUp
method and sets the component to a started state.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;start&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span>(<span class="hljs-params">callback</span>) </span>{
      <span class="hljs-keyword">var</span> _this3 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isStarted()) {
        callback();
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-built_in">this</span>.setUp(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
          callback(err);
          <span class="hljs-keyword">return</span>;
        }

        _this3.started = <span class="hljs-literal">true</span>;

        _this3.emit(<span class="hljs-string">&#x27;start&#x27;</span>);

        callback(<span class="hljs-literal">null</span>);
      });
    } <span class="hljs-comment">// ### Shutdown</span></pre></div>
            
          
            
            <p>Called when network is shut down. This sets calls the
tearDown method and sets the component back to a
non-started state.</p>
<p>The callback is called when tearDown finishes and
all active processing contexts have ended.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;shutdown&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shutdown</span>(<span class="hljs-params">callback</span>) </span>{
      <span class="hljs-keyword">var</span> _this4 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">var</span> finalize = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finalize</span>(<span class="hljs-params"></span>) </span>{</pre></div>
            
          
            
            <p>Clear contents of inport buffers</p>

            
              <div class='highlight'><pre>        <span class="hljs-keyword">var</span> inPorts = _this4.inPorts.ports || _this4.inPorts;
        <span class="hljs-built_in">Object</span>.keys(inPorts).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">portName</span>) </span>{
          <span class="hljs-keyword">var</span> inPort = inPorts[portName];

          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> inPort.clear !== <span class="hljs-string">&#x27;function&#x27;</span>) {
            <span class="hljs-keyword">return</span>;
          }

          inPort.clear();
        }); <span class="hljs-comment">// Clear bracket context</span>

        _this4.bracketContext = {
          <span class="hljs-string">&quot;in&quot;</span>: {},
          <span class="hljs-attr">out</span>: {}
        };

        <span class="hljs-keyword">if</span> (!_this4.isStarted()) {
          callback();
          <span class="hljs-keyword">return</span>;
        }

        _this4.started = <span class="hljs-literal">false</span>;

        _this4.emit(<span class="hljs-string">&#x27;end&#x27;</span>);

        callback();
      }; <span class="hljs-comment">// Tell the component that it is time to shut down</span>


      <span class="hljs-built_in">this</span>.tearDown(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        <span class="hljs-keyword">if</span> (err) {
          callback(err);
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (_this4.load &gt; <span class="hljs-number">0</span>) {</pre></div>
            
          
            
            <p>Some in-flight processes, wait for them to finish</p>

            
              <div class='highlight'><pre>          <span class="hljs-keyword">var</span> checkLoad = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLoad</span>(<span class="hljs-params">load</span>) </span>{
            <span class="hljs-keyword">if</span> (load &gt; <span class="hljs-number">0</span>) {
              <span class="hljs-keyword">return</span>;
            }

            _this4.removeListener(<span class="hljs-string">&#x27;deactivate&#x27;</span>, checkLoad);

            finalize();
          };

          _this4.on(<span class="hljs-string">&#x27;deactivate&#x27;</span>, checkLoad);

          <span class="hljs-keyword">return</span>;
        }

        finalize();
      });
    }
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isStarted&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isStarted</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.started;
    } <span class="hljs-comment">// Ensures braket forwarding map is correct for the existing ports</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;prepareForwarding&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepareForwarding</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _this5 = <span class="hljs-built_in">this</span>;

      <span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">this</span>.forwardBrackets).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">inPort</span>) </span>{
        <span class="hljs-keyword">var</span> outPorts = _this5.forwardBrackets[inPort];

        <span class="hljs-keyword">if</span> (!(inPort <span class="hljs-keyword">in</span> _this5.inPorts.ports)) {
          <span class="hljs-keyword">delete</span> _this5.forwardBrackets[inPort];
          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">var</span> tmp = [];
        outPorts.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">outPort</span>) </span>{
          <span class="hljs-keyword">if</span> (outPort <span class="hljs-keyword">in</span> _this5.outPorts.ports) {
            tmp.push(outPort);
          }
        });

        <span class="hljs-keyword">if</span> (tmp.length === <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">delete</span> _this5.forwardBrackets[inPort];
        } <span class="hljs-keyword">else</span> {
          _this5.forwardBrackets[inPort] = tmp;
        }
      });
    } <span class="hljs-comment">// Method for determining if a component is using the modern</span></pre></div>
            
          
            
            <p>NoFlo Process API</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isLegacy&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isLegacy</span>(<span class="hljs-params"></span>) </span>{</pre></div>
            
          
            
            <p>Process API</p>

            
              <div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.handle) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      } <span class="hljs-comment">// Legacy</span>


      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-comment">// Sets process handler function</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;process&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params">handle</span>) </span>{
      <span class="hljs-keyword">var</span> _this6 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handle !== <span class="hljs-string">&#x27;function&#x27;</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Process handler must be a function&#x27;</span>);
      }

      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.inPorts) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Component ports must be defined before process function&#x27;</span>);
      }

      <span class="hljs-built_in">this</span>.prepareForwarding();
      <span class="hljs-built_in">this</span>.handle = handle;
      <span class="hljs-built_in">Object</span>.keys(<span class="hljs-built_in">this</span>.inPorts.ports).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
        <span class="hljs-keyword">var</span> port = _this6.inPorts.ports[name];

        <span class="hljs-keyword">if</span> (!port.name) {
          port.name = name;
        }

        port.on(<span class="hljs-string">&#x27;ip&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
          <span class="hljs-keyword">return</span> _this6.handleIP(ip, port);
        });
      });
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;
    } <span class="hljs-comment">// Method for checking if a given inport is set up for</span></pre></div>
            
          
            
            <p>automatic bracket forwarding</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isForwardingInport&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isForwardingInport</span>(<span class="hljs-params">port</span>) </span>{
      <span class="hljs-keyword">var</span> portName;

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> port === <span class="hljs-string">&#x27;string&#x27;</span>) {
        portName = port;
      } <span class="hljs-keyword">else</span> {
        portName = port.name;
      }

      <span class="hljs-keyword">if</span> (portName <span class="hljs-keyword">in</span> <span class="hljs-built_in">this</span>.forwardBrackets) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    } <span class="hljs-comment">// Method for checking if a given outport is set up for</span></pre></div>
            
          
            
            <p>automatic bracket forwarding</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isForwardingOutport&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isForwardingOutport</span>(<span class="hljs-params">inport, outport</span>) </span>{
      <span class="hljs-keyword">var</span> inportName;
      <span class="hljs-keyword">var</span> outportName;

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> inport === <span class="hljs-string">&#x27;string&#x27;</span>) {
        inportName = inport;
      } <span class="hljs-keyword">else</span> {
        inportName = inport.name;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> outport === <span class="hljs-string">&#x27;string&#x27;</span>) {
        outportName = outport;
      } <span class="hljs-keyword">else</span> {
        outportName = outport.name;
      }

      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.forwardBrackets[inportName]) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.forwardBrackets[inportName].indexOf(outportName) !== <span class="hljs-number">-1</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    } <span class="hljs-comment">// Method for checking whether the component sends packets</span></pre></div>
            
          
            
            <p>in the same order they were received.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;isOrdered&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOrdered</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.ordered) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.autoOrdering) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    } <span class="hljs-comment">// ### Handling IP objects</span></pre></div>
            
          
            
            <p>The component has received an Information Packet. Call the
processing function so that firing pattern preconditions can
be checked and component can do processing as needed.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;handleIP&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleIP</span>(<span class="hljs-params">ip, port</span>) </span>{
      <span class="hljs-keyword">var</span> context;

      <span class="hljs-keyword">if</span> (!port.options.triggering) {</pre></div>
            
          
            
            <p>If port is non-triggering, we can skip the process function call</p>

            
              <div class='highlight'><pre>        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span> &amp;&amp; <span class="hljs-built_in">this</span>.autoOrdering === <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-built_in">this</span>.ordered) {</pre></div>
            
          
            
            <p>Switch component to ordered mode when receiving a stream unless
auto-ordering is disabled</p>

            
              <div class='highlight'><pre>        debug(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeId, <span class="hljs-string">&quot; port &#x27;&quot;</span>).concat(port.name, <span class="hljs-string">&quot;&#x27; entered auto-ordering mode&quot;</span>));
        <span class="hljs-built_in">this</span>.autoOrdering = <span class="hljs-literal">true</span>;
      } <span class="hljs-comment">// Initialize the result object for situations where output needs</span></pre></div>
            
          
            
            <p>to be queued to be kept in order</p>

            
              <div class='highlight'><pre>

      <span class="hljs-keyword">var</span> result = {};

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isForwardingInport(port)) {</pre></div>
            
          
            
            <p>For bracket-forwarding inports we need to initialize a bracket context
so that brackets can be sent as part of the output, and closed after.</p>

            
              <div class='highlight'><pre>        <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {</pre></div>
            
          
            
            <p>For forwarding ports openBrackets don’t fire</p>

            
              <div class='highlight'><pre>          <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {</pre></div>
            
          
            
            <p>For forwarding ports closeBrackets don’t fire
However, we need to handle several different scenarios:
A. There are closeBrackets in queue before current packet
B. There are closeBrackets in queue after current packet
C. We’ve queued the results from all in-flight processes and
   new closeBracket arrives</p>

            
              <div class='highlight'><pre>          <span class="hljs-keyword">var</span> buf = port.getBuffer(ip.scope, ip.index);
          <span class="hljs-keyword">var</span> dataPackets = buf.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">p</span>) </span>{
            <span class="hljs-keyword">return</span> p.type === <span class="hljs-string">&#x27;data&#x27;</span>;
          });

          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.outputQ.length &gt;= <span class="hljs-built_in">this</span>.load &amp;&amp; dataPackets.length === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (buf[<span class="hljs-number">0</span>] !== ip) {
              <span class="hljs-keyword">return</span>;
            } <span class="hljs-comment">// Remove from buffer</span>


            port.get(ip.scope, ip.index);
            context = <span class="hljs-built_in">this</span>.getBracketContext(<span class="hljs-string">&#x27;in&#x27;</span>, port.name, ip.scope, ip.index).pop();
            context.closeIp = ip;
            debugBrackets(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeId, <span class="hljs-string">&quot; closeBracket-C from &#x27;&quot;</span>).concat(context.source, <span class="hljs-string">&quot;&#x27; to &quot;</span>).concat(context.ports, <span class="hljs-string">&quot;: &#x27;&quot;</span>).concat(ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
            result = {
              <span class="hljs-attr">__resolved</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">__bracketClosingAfter</span>: [context]
            };
            <span class="hljs-built_in">this</span>.outputQ.push(result);
            <span class="hljs-built_in">this</span>.processOutputQueue();
          } <span class="hljs-comment">// Check if buffer contains data IPs. If it does, we want to allow</span></pre></div>
            
          
            
            <p>firing</p>

            
              <div class='highlight'><pre>

          <span class="hljs-keyword">if</span> (!dataPackets.length) {
            <span class="hljs-keyword">return</span>;
          }
        }
      } <span class="hljs-comment">// Prepare the input/output pair</span>


      context = <span class="hljs-keyword">new</span> ProcessContext(ip, <span class="hljs-built_in">this</span>, port, result);
      <span class="hljs-keyword">var</span> input = <span class="hljs-keyword">new</span> ProcessInput(<span class="hljs-built_in">this</span>.inPorts, context);
      <span class="hljs-keyword">var</span> output = <span class="hljs-keyword">new</span> ProcessOutput(<span class="hljs-built_in">this</span>.outPorts, context);

      <span class="hljs-keyword">try</span> {</pre></div>
            
          
            
            <p>Call the processing function</p>

            
              <div class='highlight'><pre>        <span class="hljs-built_in">this</span>.handle(input, output, context);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-built_in">this</span>.deactivate(context);
        output.sendDone(e);
      }

      <span class="hljs-keyword">if</span> (context.activated) {
        <span class="hljs-keyword">return</span>;
      } <span class="hljs-comment">// If receiving an IP object didn&#x27;t cause the component to</span></pre></div>
            
          
            
            <p>activate, log that input conditions were not met</p>

            
              <div class='highlight'><pre>

      <span class="hljs-keyword">if</span> (port.isAddressable()) {
        debug(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeId, <span class="hljs-string">&quot; packet on &#x27;&quot;</span>).concat(port.name, <span class="hljs-string">&quot;[&quot;</span>).concat(ip.index, <span class="hljs-string">&quot;]&#x27; didn&#x27;t match preconditions: &quot;</span>).concat(ip.type));
        <span class="hljs-keyword">return</span>;
      }

      debug(<span class="hljs-string">&quot;&quot;</span>.concat(<span class="hljs-built_in">this</span>.nodeId, <span class="hljs-string">&quot; packet on &#x27;&quot;</span>).concat(port.name, <span class="hljs-string">&quot;&#x27; didn&#x27;t match preconditions: &quot;</span>).concat(ip.type));
    } <span class="hljs-comment">// Get the current bracket forwarding context for an IP object</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getBracketContext&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBracketContext</span>(<span class="hljs-params">type, port, scope, idx</span>) </span>{
      <span class="hljs-keyword">var</span> _ports$normalizePortN = ports.normalizePortName(port),
          name = _ports$normalizePortN.name,
          index = _ports$normalizePortN.index;

      <span class="hljs-keyword">if</span> (idx != <span class="hljs-literal">null</span>) {
        index = idx;
      }

      <span class="hljs-keyword">var</span> portsList = type === <span class="hljs-string">&#x27;in&#x27;</span> ? <span class="hljs-built_in">this</span>.inPorts : <span class="hljs-built_in">this</span>.outPorts;

      <span class="hljs-keyword">if</span> (portsList[name].isAddressable()) {
        name = <span class="hljs-string">&quot;&quot;</span>.concat(name, <span class="hljs-string">&quot;[&quot;</span>).concat(index, <span class="hljs-string">&quot;]&quot;</span>);
      } <span class="hljs-keyword">else</span> {
        name = port;
      } <span class="hljs-comment">// Ensure we have a bracket context for the current scope</span>


      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.bracketContext[type][name]) {
        <span class="hljs-built_in">this</span>.bracketContext[type][name] = {};
      }

      <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.bracketContext[type][name][scope]) {
        <span class="hljs-built_in">this</span>.bracketContext[type][name][scope] = [];
      }

      <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.bracketContext[type][name][scope];
    } <span class="hljs-comment">// Add an IP object to the list of results to be sent in</span></pre></div>
            
          
            
            <p>order</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;addToResult&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToResult</span>(<span class="hljs-params">result, port, packet</span>) </span>{
      <span class="hljs-keyword">var</span> before = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>] !== <span class="hljs-literal">undefined</span> ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">3</span>] : <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">var</span> res = result;
      <span class="hljs-keyword">var</span> ip = packet;

      <span class="hljs-keyword">var</span> _ports$normalizePortN2 = ports.normalizePortName(port),
          name = _ports$normalizePortN2.name,
          index = _ports$normalizePortN2.index;

      <span class="hljs-keyword">var</span> method = before ? <span class="hljs-string">&#x27;unshift&#x27;</span> : <span class="hljs-string">&#x27;push&#x27;</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.outPorts[name].isAddressable()) {
        <span class="hljs-keyword">var</span> idx = index ? <span class="hljs-built_in">parseInt</span>(index, <span class="hljs-number">10</span>) : ip.index;

        <span class="hljs-keyword">if</span> (!res[name]) {
          res[name] = {};
        }

        <span class="hljs-keyword">if</span> (!res[name][idx]) {
          res[name][idx] = [];
        }

        ip.index = idx;
        res[name][idx][method](ip);
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (!res[name]) {
        res[name] = [];
      }

      res[name][method](ip);
    } <span class="hljs-comment">// Get contexts that can be forwarded with this in/outport</span></pre></div>
            
          
            
            <p>pair.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;getForwardableContexts&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForwardableContexts</span>(<span class="hljs-params">inport, outport, contexts</span>) </span>{
      <span class="hljs-keyword">var</span> _this7 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">var</span> _ports$normalizePortN3 = ports.normalizePortName(outport),
          name = _ports$normalizePortN3.name,
          index = _ports$normalizePortN3.index;

      <span class="hljs-keyword">var</span> forwardable = [];
      contexts.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ctx, idx</span>) </span>{</pre></div>
            
          
            
            <p>No forwarding to this outport</p>

            
              <div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!_this7.isForwardingOutport(inport, name)) {
          <span class="hljs-keyword">return</span>;
        } <span class="hljs-comment">// We have already forwarded this context to this outport</span>


        <span class="hljs-keyword">if</span> (ctx.ports.indexOf(outport) !== <span class="hljs-number">-1</span>) {
          <span class="hljs-keyword">return</span>;
        } <span class="hljs-comment">// See if we have already forwarded the same bracket from another</span></pre></div>
            
          
            
            <p>inport</p>

            
              <div class='highlight'><pre>

        <span class="hljs-keyword">var</span> outContext = _this7.getBracketContext(<span class="hljs-string">&#x27;out&#x27;</span>, name, ctx.ip.scope, index)[idx];

        <span class="hljs-keyword">if</span> (outContext) {
          <span class="hljs-keyword">if</span> (outContext.ip.data === ctx.ip.data &amp;&amp; outContext.ports.indexOf(outport) !== <span class="hljs-number">-1</span>) {
            <span class="hljs-keyword">return</span>;
          }
        }

        forwardable.push(ctx);
      });
      <span class="hljs-keyword">return</span> forwardable;
    } <span class="hljs-comment">// Add any bracket forwards needed to the result queue</span>

  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;addBracketForwards&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addBracketForwards</span>(<span class="hljs-params">result</span>) </span>{
      <span class="hljs-keyword">var</span> _this8 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">var</span> res = result;

      <span class="hljs-keyword">if</span> (res.__bracketClosingBefore != <span class="hljs-literal">null</span> ? res.__bracketClosingBefore.length : <span class="hljs-literal">undefined</span>) {
        res.__bracketClosingBefore.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
          debugBrackets(<span class="hljs-string">&quot;&quot;</span>.concat(_this8.nodeId, <span class="hljs-string">&quot; closeBracket-A from &#x27;&quot;</span>).concat(context.source, <span class="hljs-string">&quot;&#x27; to &quot;</span>).concat(context.ports, <span class="hljs-string">&quot;: &#x27;&quot;</span>).concat(context.closeIp.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));

          <span class="hljs-keyword">if</span> (!context.ports.length) {
            <span class="hljs-keyword">return</span>;
          }

          context.ports.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">port</span>) </span>{
            <span class="hljs-keyword">var</span> ipClone = context.closeIp.clone();

            _this8.addToResult(res, port, ipClone, <span class="hljs-literal">true</span>);

            _this8.getBracketContext(<span class="hljs-string">&#x27;out&#x27;</span>, port, ipClone.scope).pop();
          });
        });
      }

      <span class="hljs-keyword">if</span> (res.__bracketContext) {</pre></div>
            
          
            
            <p>First see if there are any brackets to forward. We need to reverse
the keys so that they get added in correct order</p>

            
              <div class='highlight'><pre>        <span class="hljs-built_in">Object</span>.keys(res.__bracketContext).reverse().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">inport</span>) </span>{
          <span class="hljs-keyword">var</span> context = res.__bracketContext[inport];

          <span class="hljs-keyword">if</span> (!context.length) {
            <span class="hljs-keyword">return</span>;
          }

          <span class="hljs-built_in">Object</span>.keys(res).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">outport</span>) </span>{
            <span class="hljs-keyword">var</span> datas;
            <span class="hljs-keyword">var</span> forwardedOpens;
            <span class="hljs-keyword">var</span> unforwarded;
            <span class="hljs-keyword">var</span> ips = res[outport];

            <span class="hljs-keyword">if</span> (outport.indexOf(<span class="hljs-string">&#x27;__&#x27;</span>) === <span class="hljs-number">0</span>) {
              <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (_this8.outPorts[outport].isAddressable()) {
              <span class="hljs-built_in">Object</span>.keys(ips).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">idx</span>) </span>{</pre></div>
            
          
            
            <p>Don’t register indexes we’re only sending brackets to</p>

            
              <div class='highlight'><pre>                <span class="hljs-keyword">var</span> idxIps = ips[idx];
                datas = idxIps.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
                  <span class="hljs-keyword">return</span> ip.type === <span class="hljs-string">&#x27;data&#x27;</span>;
                });

                <span class="hljs-keyword">if</span> (!datas.length) {
                  <span class="hljs-keyword">return</span>;
                }

                <span class="hljs-keyword">var</span> portIdentifier = <span class="hljs-string">&quot;&quot;</span>.concat(outport, <span class="hljs-string">&quot;[&quot;</span>).concat(idx, <span class="hljs-string">&quot;]&quot;</span>);
                unforwarded = _this8.getForwardableContexts(inport, portIdentifier, context);

                <span class="hljs-keyword">if</span> (!unforwarded.length) {
                  <span class="hljs-keyword">return</span>;
                }

                forwardedOpens = [];
                unforwarded.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) </span>{
                  debugBrackets(<span class="hljs-string">&quot;&quot;</span>.concat(_this8.nodeId, <span class="hljs-string">&quot; openBracket from &#x27;&quot;</span>).concat(inport, <span class="hljs-string">&quot;&#x27; to &#x27;&quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot;&#x27;: &#x27;&quot;</span>).concat(ctx.ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
                  <span class="hljs-keyword">var</span> ipClone = ctx.ip.clone();
                  ipClone.index = <span class="hljs-built_in">parseInt</span>(idx, <span class="hljs-number">10</span>);
                  forwardedOpens.push(ipClone);
                  ctx.ports.push(portIdentifier);

                  _this8.getBracketContext(<span class="hljs-string">&#x27;out&#x27;</span>, outport, ctx.ip.scope, idx).push(ctx);
                });
                forwardedOpens.reverse();
                forwardedOpens.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
                  _this8.addToResult(res, outport, ip, <span class="hljs-literal">true</span>);
                });
              });
              <span class="hljs-keyword">return</span>;
            } <span class="hljs-comment">// Don&#x27;t register ports we&#x27;re only sending brackets to</span>


            datas = ips.filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
              <span class="hljs-keyword">return</span> ip.type === <span class="hljs-string">&#x27;data&#x27;</span>;
            });

            <span class="hljs-keyword">if</span> (!datas.length) {
              <span class="hljs-keyword">return</span>;
            }

            unforwarded = _this8.getForwardableContexts(inport, outport, context);

            <span class="hljs-keyword">if</span> (!unforwarded.length) {
              <span class="hljs-keyword">return</span>;
            }

            forwardedOpens = [];
            unforwarded.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) </span>{
              debugBrackets(<span class="hljs-string">&quot;&quot;</span>.concat(_this8.nodeId, <span class="hljs-string">&quot; openBracket from &#x27;&quot;</span>).concat(inport, <span class="hljs-string">&quot;&#x27; to &#x27;&quot;</span>).concat(outport, <span class="hljs-string">&quot;&#x27;: &#x27;&quot;</span>).concat(ctx.ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
              forwardedOpens.push(ctx.ip.clone());
              ctx.ports.push(outport);

              _this8.getBracketContext(<span class="hljs-string">&#x27;out&#x27;</span>, outport, ctx.ip.scope).push(ctx);
            });
            forwardedOpens.reverse();
            forwardedOpens.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ip</span>) </span>{
              _this8.addToResult(res, outport, ip, <span class="hljs-literal">true</span>);
            });
          });
        });
      }

      <span class="hljs-keyword">if</span> (res.__bracketClosingAfter != <span class="hljs-literal">null</span> ? res.__bracketClosingAfter.length : <span class="hljs-literal">undefined</span>) {
        res.__bracketClosingAfter.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">context</span>) </span>{
          debugBrackets(<span class="hljs-string">&quot;&quot;</span>.concat(_this8.nodeId, <span class="hljs-string">&quot; closeBracket-B from &#x27;&quot;</span>).concat(context.source, <span class="hljs-string">&quot;&#x27; to &quot;</span>).concat(context.ports, <span class="hljs-string">&quot;: &#x27;&quot;</span>).concat(context.closeIp.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));

          <span class="hljs-keyword">if</span> (!context.ports.length) {
            <span class="hljs-keyword">return</span>;
          }

          context.ports.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">port</span>) </span>{
            <span class="hljs-keyword">var</span> ipClone = context.closeIp.clone();

            _this8.addToResult(res, port, ipClone, <span class="hljs-literal">false</span>);

            _this8.getBracketContext(<span class="hljs-string">&#x27;out&#x27;</span>, port, ipClone.scope).pop();
          });
        });
      }

      <span class="hljs-keyword">delete</span> res.__bracketClosingBefore;
      <span class="hljs-keyword">delete</span> res.__bracketContext;
      <span class="hljs-keyword">delete</span> res.__bracketClosingAfter;
    } <span class="hljs-comment">// Whenever an execution context finishes, send all resolved</span></pre></div>
            
          
            
            <p>output from the queue in the order it is in.</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;processOutputQueue&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processOutputQueue</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> _this9 = <span class="hljs-built_in">this</span>;

      <span class="hljs-keyword">var</span> _loop = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_loop</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (!_this9.outputQ[<span class="hljs-number">0</span>].__resolved) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;break&quot;</span>;
        }

        <span class="hljs-keyword">var</span> result = _this9.outputQ.shift();

        _this9.addBracketForwards(result);

        <span class="hljs-built_in">Object</span>.keys(result).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">port</span>) </span>{
          <span class="hljs-keyword">var</span> portIdentifier;
          <span class="hljs-keyword">var</span> ips = result[port];

          <span class="hljs-keyword">if</span> (port.indexOf(<span class="hljs-string">&#x27;__&#x27;</span>) === <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span>;
          }

          <span class="hljs-keyword">if</span> (_this9.outPorts.ports[port].isAddressable()) {
            <span class="hljs-built_in">Object</span>.keys(ips).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
              <span class="hljs-keyword">var</span> idxIps = ips[index];
              <span class="hljs-keyword">var</span> idx = <span class="hljs-built_in">parseInt</span>(index, <span class="hljs-number">10</span>);

              <span class="hljs-keyword">if</span> (!_this9.outPorts.ports[port].isAttached(idx)) {
                <span class="hljs-keyword">return</span>;
              }

              idxIps.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">packet</span>) </span>{
                <span class="hljs-keyword">var</span> ip = packet;
                portIdentifier = <span class="hljs-string">&quot;&quot;</span>.concat(port, <span class="hljs-string">&quot;[&quot;</span>).concat(ip.index, <span class="hljs-string">&quot;]&quot;</span>);

                <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {
                  debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; &lt; &#x27;&quot;</span>).concat(ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {
                  debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; &gt; &#x27;&quot;</span>).concat(ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
                } <span class="hljs-keyword">else</span> {
                  debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; DATA&quot;</span>));
                }

                <span class="hljs-keyword">if</span> (!_this9.outPorts[port].options.scoped) {
                  ip.scope = <span class="hljs-literal">null</span>;
                }

                _this9.outPorts[port].sendIP(ip);
              });
            });
            <span class="hljs-keyword">return</span>;
          }

          <span class="hljs-keyword">if</span> (!_this9.outPorts.ports[port].isAttached()) {
            <span class="hljs-keyword">return</span>;
          }

          ips.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">packet</span>) </span>{
            <span class="hljs-keyword">var</span> ip = packet;
            portIdentifier = port;

            <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;openBracket&#x27;</span>) {
              debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; &lt; &#x27;&quot;</span>).concat(ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ip.type === <span class="hljs-string">&#x27;closeBracket&#x27;</span>) {
              debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; &gt; &#x27;&quot;</span>).concat(ip.data, <span class="hljs-string">&quot;&#x27;&quot;</span>));
            } <span class="hljs-keyword">else</span> {
              debugSend(<span class="hljs-string">&quot;&quot;</span>.concat(_this9.nodeId, <span class="hljs-string">&quot; sending &quot;</span>).concat(portIdentifier, <span class="hljs-string">&quot; DATA&quot;</span>));
            }

            <span class="hljs-keyword">if</span> (!_this9.outPorts[port].options.scoped) {
              ip.scope = <span class="hljs-literal">null</span>;
            }

            _this9.outPorts[port].sendIP(ip);
          });
        });
      };

      <span class="hljs-keyword">while</span> (<span class="hljs-built_in">this</span>.outputQ.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> _ret = _loop();

        <span class="hljs-keyword">if</span> (_ret === <span class="hljs-string">&quot;break&quot;</span>) <span class="hljs-keyword">break</span>;
      }
    } <span class="hljs-comment">// Signal that component has activated. There may be multiple</span></pre></div>
            
          
            
            <p>activated contexts at the same time</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;activate&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">activate</span>(<span class="hljs-params">context</span>) </span>{
      <span class="hljs-keyword">if</span> (context.activated) {
        <span class="hljs-keyword">return</span>;
      } <span class="hljs-comment">// prevent double activation</span>


      context.activated = <span class="hljs-literal">true</span>;
      context.deactivated = <span class="hljs-literal">false</span>;
      <span class="hljs-built_in">this</span>.load += <span class="hljs-number">1</span>;
      <span class="hljs-built_in">this</span>.emit(<span class="hljs-string">&#x27;activate&#x27;</span>, <span class="hljs-built_in">this</span>.load);

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.ordered || <span class="hljs-built_in">this</span>.autoOrdering) {
        <span class="hljs-built_in">this</span>.outputQ.push(context.result);
      }
    } <span class="hljs-comment">// Signal that component has deactivated. There may be multiple</span></pre></div>
            
          
            
            <p>activated contexts at the same time</p>

            
              <div class='highlight'><pre>
  }, {
    <span class="hljs-attr">key</span>: <span class="hljs-string">&quot;deactivate&quot;</span>,
    <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deactivate</span>(<span class="hljs-params">context</span>) </span>{
      <span class="hljs-keyword">if</span> (context.deactivated) {
        <span class="hljs-keyword">return</span>;
      } <span class="hljs-comment">// prevent double deactivation</span>


      context.deactivated = <span class="hljs-literal">true</span>;
      context.activated = <span class="hljs-literal">false</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.isOrdered()) {
        <span class="hljs-built_in">this</span>.processOutputQueue();
      }

      <span class="hljs-built_in">this</span>.load -= <span class="hljs-number">1</span>;
      <span class="hljs-built_in">this</span>.emit(<span class="hljs-string">&#x27;deactivate&#x27;</span>, <span class="hljs-built_in">this</span>.load);
    }
  }]);

  <span class="hljs-keyword">return</span> Component;
}(EventEmitter);

Component.description = <span class="hljs-string">&#x27;&#x27;</span>;
Component.icon = <span class="hljs-literal">null</span>;
<span class="hljs-built_in">exports</span>.Component = Component;</pre></div>
            
          
          <p><small>This page contains documentation generated automatically from NoFlo's <a href="https://github.com/noflo/noflo/blob/master/src/lib/Component.coffee">Component.coffee</a> file.</small></p>
        </div>
      </div>
    </div>
  </div>
